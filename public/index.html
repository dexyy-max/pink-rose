<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <title>粉色旋转玫瑰 · 祝福</title>
    <style>
      :root{
        --bg:#0a0a12;
        --pink:#ff7ab8;
        --pink2:#ff3fa6;
        --light:#ffe6f3;
        --overlay: rgba(0,0,0,.55);
      }
      html,body{height:100%}
      body{margin:0;background: radial-gradient(1200px 600px at 50% -100px, #1a1020 0%, var(--bg) 60%);color:#fff;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Noto Sans",sans-serif;overflow:hidden}
      #stage{position:absolute;inset:0;width:100%;height:100%;display:block}
      .credit{position:fixed;left:12px;bottom:10px;opacity:.75;font-size:12px;user-select:none}
      .modal-mask{position:fixed;inset:0;background:var(--overlay);display:none;align-items:center;justify-content:center;z-index:10;padding:16px}
      .modal{width:min(92vw,480px);background:rgba(17,25,40,.85);border:1px solid rgba(255,255,255,.1);border-radius:14px;box-shadow:0 20px 40px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.06);backdrop-filter:blur(8px)}
      .modal header{padding:14px 18px;border-bottom:1px solid rgba(255,255,255,.06);font-weight:600}
      .modal main{padding:18px;font-size:16px;line-height:1.6}
      .modal footer{display:flex;gap:10px;justify-content:flex-end;padding:12px 18px 16px}
      .btn{appearance:none;border:0;padding:10px 14px;border-radius:10px;font-weight:600;cursor:pointer}
      .btn-primary{background:linear-gradient(135deg,var(--pink),var(--pink2));color:#210012}
      .btn-ghost{background:transparent;color:#ffd1e8}
    </style>
  </head>
  <body>
    <canvas id="stage"></canvas>
    <div class="credit">愿爱与玫瑰常在</div>

    <div id="modalMask" class="modal-mask" role="dialog" aria-modal="true" aria-hidden="true">
      <div class="modal">
        <header id="modalTitle">浪漫祝福</header>
        <main id="modalContent"></main>
        <footer>
          <button id="btnClose" class="btn btn-ghost">稍后再看</button>
          <button id="btnNext" class="btn btn-primary">下一条</button>
        </footer>
      </div>
    </div>

    <script>
      const canvas = document.getElementById('stage');
      const ctx = canvas.getContext('2d');
      const DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      let W, H, CX, CY;
      function resize(){
        W = canvas.clientWidth = innerWidth;
        H = canvas.clientHeight = innerHeight;
        canvas.width = Math.floor(W * DPR);
        canvas.height = Math.floor(H * DPR);
        ctx.setTransform(DPR,0,0,DPR,0,0);
        CX = W/2; CY = H/2 + Math.min(120, H*0.05);
      }
      resize(); addEventListener('resize', resize);

      // hearts particles
      const hearts = Array.from({length:120}, ()=>({
        a: Math.random()*Math.PI*2,
        r: 80 + Math.random()*260,
        z: Math.random()*0.8+0.2,
        spd: (Math.random()*0.4+0.2) * (Math.random()<0.5?-1:1)
      }));

      // draw a heart at x,y, size, alpha
      function heart(x,y,s,alpha){
        ctx.save();
        ctx.translate(x,y); ctx.scale(s,s);
        ctx.globalAlpha = alpha;
        ctx.fillStyle = 'rgba(255,122,184,0.9)';
        ctx.beginPath();
        for(let t=0;t<Math.PI*2;t+=0.2){
          const hx = 16*Math.pow(Math.sin(t),3);
          const hy = 13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t);
          t===0?ctx.moveTo(hx,-hy):ctx.lineTo(hx,-hy);
        }
        ctx.closePath(); ctx.fill();
        ctx.restore();
      }

      // rose curve parameters
      function drawRose(time){
        // base glow
        const grd = ctx.createRadialGradient(CX, CY-120, 10, CX, CY-160, 340);
        grd.addColorStop(0,'rgba(255,170,210,.20)');
        grd.addColorStop(1,'rgba(0,0,0,0)');
        ctx.fillStyle = grd; ctx.beginPath(); ctx.arc(CX, CY-140, 340, 0, Math.PI*2); ctx.fill();

        // spinning rings
        ctx.save();
        ctx.translate(CX, CY);
        ctx.rotate(time*0.6);
        ctx.strokeStyle = 'rgba(255,170,210,.7)';
        ctx.lineWidth = 2; ctx.shadowColor = 'rgba(255,170,210,.8)'; ctx.shadowBlur = 12;
        for(let i=0;i<3;i++){
          ctx.beginPath();
          ctx.ellipse(0,-40-i*14, 220+i*10, 40, 0, 0, Math.PI*2);
          ctx.stroke();
        }
        ctx.restore();

        // rotating rose (polar curve r = a * (1 - sin(kθ)) )
        ctx.save();
        ctx.translate(CX, CY-40);
        ctx.rotate(time*0.8);
        const a = 140; const k = 6; // petals count approx k
        ctx.lineWidth = 2;
        for(let layer=0; layer<4; layer++){
          const alpha = 0.55 - layer*0.1;
          ctx.strokeStyle = `rgba(255,122,184,${alpha})`;
          ctx.fillStyle = `rgba(255,63,166,${alpha*0.6})`;
          ctx.beginPath();
          for(let t=0; t<=Math.PI*2+0.001; t+=0.01){
            const r = a*(1 - 0.6*Math.sin(k*t + layer*0.6));
            const x = r*Math.cos(t)*0.6; // squash for perspective
            const y = r*Math.sin(t);
            t===0?ctx.moveTo(x,y):ctx.lineTo(x,y);
          }
          ctx.closePath(); ctx.fill(); ctx.stroke();
        }
        // stem
        ctx.strokeStyle = 'rgba(220,190,210,.9)'; ctx.lineWidth = 4;
        ctx.beginPath(); ctx.moveTo(0,0); ctx.lineTo(0,160); ctx.stroke();
        ctx.restore();
      }

      let start = performance.now();
      function draw(){
        const t = (performance.now()-start)/1000;
        ctx.clearRect(0,0,W,H);

        // orbit hearts
        hearts.forEach(h=>{
          h.a += h.spd*0.01;
          const x = CX + Math.cos(h.a)*h.r;
          const y = CY - 40 + Math.sin(h.a*1.3)*30;
          heart(x,y, 0.06*h.z + 0.04, 0.5*h.z + 0.25);
        });

        drawRose(t);

        requestAnimationFrame(draw);
      }
      draw();

      // Popups
      const wishes = [
        '田梦莹宝宝，送你一束粉色旋转玫瑰，愿你被温柔围绕 ✨',
        '好好吃饭，照顾好自己，能量满满！',
        '天天开心，所念皆如愿，所行皆坦途。',
        '天气冷了记得添衣服，别感冒啦～',
      ];
      const mask = document.getElementById('modalMask');
      const content = document.getElementById('modalContent');
      const btnNext = document.getElementById('btnNext');
      const btnClose = document.getElementById('btnClose');
      let idx = 0;
      function showModal(text){ content.textContent = text; mask.style.display = 'flex'; mask.setAttribute('aria-hidden','false'); }
      function hideModal(){ mask.style.display = 'none'; mask.setAttribute('aria-hidden','true'); }
      btnNext.addEventListener('click', ()=>{ idx++; if(idx<wishes.length){ showModal(wishes[idx]); } else { hideModal(); }});
      btnClose.addEventListener('click', hideModal);
      mask.addEventListener('click', (e)=>{ if(e.target===mask) hideModal(); });
      setTimeout(()=>showModal(wishes[0]), 2400);
    </script>
  </body>
  </html>


