<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <title>粉色水晶旋转玫瑰 · 祝福</title>
    <style>
      :root{
        --bg:#0a0a12;
        --pink:#ff7ab8;
        --pink2:#ff3fa6;
        --light:#ffe6f3;
        --overlay: rgba(0,0,0,.55);
      }
      html,body{height:100%;margin:0;overflow:hidden}
      body{background: radial-gradient(1200px 600px at 50% -100px, #1a1020 0%, var(--bg) 60%);color:#fff;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Noto Sans",sans-serif}
      #container{position:absolute;inset:0;width:100%;height:100%}
      .credit{position:fixed;left:12px;bottom:10px;opacity:.75;font-size:12px;user-select:none;z-index:5}
      .modal-mask{position:fixed;inset:0;background:var(--overlay);display:none;align-items:center;justify-content:center;z-index:100;padding:16px}
      .modal{width:min(92vw,480px);background:rgba(17,25,40,.85);border:1px solid rgba(255,255,255,.1);border-radius:14px;box-shadow:0 20px 40px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.06);backdrop-filter:blur(8px)}
      .modal header{padding:14px 18px;border-bottom:1px solid rgba(255,255,255,.06);font-weight:600}
      .modal main{padding:18px;font-size:16px;line-height:1.6}
      .modal footer{display:flex;gap:10px;justify-content:flex-end;padding:12px 18px 16px}
      .btn{appearance:none;border:0;padding:10px 14px;border-radius:10px;font-weight:600;cursor:pointer}
      .btn-primary{background:linear-gradient(135deg,var(--pink),var(--pink2));color:#210012}
      .btn-ghost{background:transparent;color:#ffd1e8}
    </style>
  </head>
  <body>
    <div id="container"></div>
    <div class="credit">愿爱与玫瑰常在</div>

    <div id="modalMask" class="modal-mask" role="dialog" aria-modal="true" aria-hidden="true">
      <div class="modal">
        <header id="modalTitle">浪漫祝福</header>
        <main id="modalContent"></main>
        <footer>
          <button id="btnClose" class="btn btn-ghost">稍后再看</button>
          <button id="btnNext" class="btn btn-primary">下一条</button>
        </footer>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/three@0.168.0/build/three.min.js"></script>
    <script>

      const container = document.getElementById('container');
      let W = innerWidth, H = innerHeight;
      
      // Scene
      const scene = new THREE.Scene();
      scene.background = new THREE.Color(0x0a0a12);

      // Camera
      const camera = new THREE.PerspectiveCamera(50, W/H, 0.1, 1000);
      camera.position.set(0, 3, 12);
      camera.lookAt(0, 0, 0);

      // Renderer
      const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
      renderer.setSize(W, H);
      renderer.setPixelRatio(Math.min(2, devicePixelRatio));
      renderer.shadowMap.enabled = true;
      container.appendChild(renderer.domElement);

      function resize(){
        W = innerWidth; H = innerHeight;
        camera.aspect = W/H; camera.updateProjectionMatrix();
        renderer.setSize(W, H);
      }
      addEventListener('resize', resize);

      // Lights
      const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
      scene.add(ambientLight);
      const pointLight1 = new THREE.PointLight(0xff7ab8, 1.2, 20);
      pointLight1.position.set(3, 4, 5);
      scene.add(pointLight1);
      const pointLight2 = new THREE.PointLight(0xff3fa6, 0.8, 20);
      pointLight2.position.set(-3, 4, -5);
      scene.add(pointLight2);

      // Pink crystal material
      const pinkCrystalMaterial = new THREE.MeshPhysicalMaterial({
        color: 0xff7ab8,
        transparent: true,
        opacity: 0.75,
        metalness: 0.1,
        roughness: 0.05,
        clearcoat: 1.0,
        clearcoatRoughness: 0.02,
        emissive: 0xff3fa6,
        emissiveIntensity: 0.15,
      });

      const stemMaterial = new THREE.MeshPhysicalMaterial({
        color: 0xff7ab8,
        transparent: true,
        opacity: 0.7,
        metalness: 0.05,
        roughness: 0.1,
      });

      const leafMaterial = new THREE.MeshPhysicalMaterial({
        color: 0xff8ac8,
        transparent: true,
        opacity: 0.8,
        metalness: 0.08,
        roughness: 0.05,
      });

      const ringMaterial = new THREE.MeshPhysicalMaterial({
        color: 0xff7ab8,
        transparent: true,
        opacity: 0.3,
        metalness: 0.0,
        roughness: 0.0,
        side: THREE.DoubleSide,
      });

      // Rose flower (deformed sphere)
      const roseGeometry = new THREE.SphereGeometry(1.2, 30, 30);
      const positions = roseGeometry.attributes.position;
      for(let i=0; i<positions.count; i++){
        const x = positions.getX(i), y = positions.getY(i), z = positions.getZ(i);
        const r = Math.sqrt(x*x + y*y + z*z);
        const scale = 1 + 0.15*Math.sin(r*8) * Math.cos(y*3);
        positions.setXYZ(i, x*scale, y*scale, z*scale);
      }
      positions.needsUpdate = true;
      roseGeometry.computeVertexNormals();
      const roseFlower = new THREE.Mesh(roseGeometry, pinkCrystalMaterial);
      roseFlower.castShadow = true;
      scene.add(roseFlower);

      // Stem
      const stemGeometry = new THREE.CylinderGeometry(0.08, 0.12, 2.5, 16);
      const stem = new THREE.Mesh(stemGeometry, stemMaterial);
      stem.position.set(0, -1.25, 0);
      scene.add(stem);

      // Leaves
      const leafGeometry1 = new THREE.PlaneGeometry(0.8, 0.5);
      const leaf1 = new THREE.Mesh(leafGeometry1, leafMaterial);
      leaf1.position.set(0.8, 0.3, 0);
      leaf1.rotation.z = Math.PI/6;
      scene.add(leaf1);

      const leafGeometry2 = new THREE.PlaneGeometry(0.7, 0.4);
      const leaf2 = new THREE.Mesh(leafGeometry2, leafMaterial);
      leaf2.position.set(-0.8, 0.1, 0);
      leaf2.rotation.z = -Math.PI/9;
      scene.add(leaf2);

      // Rings (orbital rings)
      const ringGeometry = new THREE.RingGeometry(2, 2.2, 60);
      const ring1 = new THREE.Mesh(ringGeometry, ringMaterial);
      ring1.rotation.x = Math.PI/4;
      scene.add(ring1);

      const ring2 = new THREE.Mesh(ringGeometry, ringMaterial);
      ring2.rotation.x = -Math.PI/4;
      scene.add(ring2);

      // Crystal fragments
      const fragmentGeometry = new THREE.BoxGeometry(0.2, 0.2, 0.2);
      const fragment1 = new THREE.Mesh(fragmentGeometry, pinkCrystalMaterial);
      fragment1.position.set(-2.1, 0.5, 0.1);
      scene.add(fragment1);

      const fragment2 = new THREE.Mesh(fragmentGeometry, pinkCrystalMaterial);
      fragment2.position.set(-2.3, 0.3, 0.05);
      fragment2.scale.set(0.8, 0.8, 0.8);
      scene.add(fragment2);

      // Butterfly wings (simplified)
      const wingGeometry = new THREE.PlaneGeometry(0.5, 0.4);
      const butterflyWing1 = new THREE.Mesh(wingGeometry, leafMaterial);
      butterflyWing1.position.set(2.0, 0.5, 0);
      butterflyWing1.rotation.z = Math.PI/4;
      scene.add(butterflyWing1);

      const butterflyWing2 = new THREE.Mesh(wingGeometry, leafMaterial);
      butterflyWing2.position.set(2.2, 0.3, 0);
      butterflyWing2.rotation.z = -Math.PI/4;
      scene.add(butterflyWing2);

      // Heart particles
      const hearts = [];
      const heartShape = new THREE.Shape();
      for(let t=0; t<Math.PI*2; t+=0.1){
        const hx = 16*Math.pow(Math.sin(t),3);
        const hy = 13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t);
        t===0 ? heartShape.moveTo(hx/10, -hy/10) : heartShape.lineTo(hx/10, -hy/10);
      }
      const heartGeometry = new THREE.ShapeGeometry(heartShape);
      const heartMaterial = new THREE.MeshBasicMaterial({
        color: 0xff7ab8,
        transparent: true,
        opacity: 0.7,
      });
      
      for(let i=0; i<80; i++){
        const heart = new THREE.Mesh(heartGeometry, heartMaterial);
        const angle = Math.random()*Math.PI*2;
        const radius = 3 + Math.random()*4;
        heart.position.set(
          Math.cos(angle)*radius,
          Math.sin(angle*1.3)*1.5,
          Math.sin(angle)*radius
        );
        heart.scale.setScalar(0.08 + Math.random()*0.05);
        heart.userData = { angle, radius, speed: (Math.random()*0.5+0.2)*(Math.random()<0.5?-1:1) };
        scene.add(heart);
        hearts.push(heart);
      }

      // Group for rotation
      const roseGroup = new THREE.Group();
      scene.add(roseGroup);
      [roseFlower, stem, leaf1, leaf2, fragment1, fragment2, butterflyWing1, butterflyWing2].forEach(m=>{
        const clone = m.clone();
        clone.material = m.material.clone();
        roseGroup.add(clone);
        scene.remove(m);
      });

      // Animation
      let time = 0;
      function animate(){
        requestAnimationFrame(animate);
        time += 0.01;

        // Rotate rose group
        roseGroup.rotation.y = time * 0.6;
        roseGroup.rotation.x = Math.sin(time*0.5) * 0.1;

        // Rotate rings
        ring1.rotation.z += 0.005;
        ring2.rotation.z -= 0.005;

        // Animate hearts
        hearts.forEach(h=>{
          h.userData.angle += h.userData.speed * 0.01;
          const r = h.userData.radius;
          h.position.set(
            Math.cos(h.userData.angle)*r,
            Math.sin(h.userData.angle*1.3)*1.5,
            Math.sin(h.userData.angle)*r
          );
          h.rotation.z += 0.02;
        });

        // Butterfly wing flapping
        const flap = Math.sin(time*8)*0.2;
        butterflyWing1.rotation.z = Math.PI/4 + flap;
        butterflyWing2.rotation.z = -Math.PI/4 - flap;

        renderer.render(scene, camera);
      }
      animate();

      // Popups
      const wishes = [
        '田梦莹宝宝，送你一束粉色水晶旋转玫瑰，愿你被温柔围绕 ✨',
        '好好吃饭，照顾好自己，能量满满！',
        '天天开心，所念皆如愿，所行皆坦途。',
        '天气冷了记得添衣服，别感冒啦～',
      ];
      const mask = document.getElementById('modalMask');
      const content = document.getElementById('modalContent');
      const btnNext = document.getElementById('btnNext');
      const btnClose = document.getElementById('btnClose');
      let idx = 0;
      function showModal(text){ content.textContent = text; mask.style.display = 'flex'; mask.setAttribute('aria-hidden','false'); }
      function hideModal(){ mask.style.display = 'none'; mask.setAttribute('aria-hidden','true'); }
      btnNext.addEventListener('click', ()=>{ idx++; if(idx<wishes.length){ showModal(wishes[idx]); } else { hideModal(); }});
      btnClose.addEventListener('click', hideModal);
      mask.addEventListener('click', (e)=>{ if(e.target===mask) hideModal(); });
      setTimeout(()=>showModal(wishes[0]), 2400);
    </script>
  </body>
</html>
